# MySpiderProject é¡¹ç›®æ¡†æ¶ä¸å·¥ä½œæµç¨‹

è¿™æ˜¯ä¸€ä¸ªåŸºäº Python Selenium çš„æ¨¡å—åŒ–ã€é«˜å¹¶å‘çˆ¬è™«é¡¹ç›®ï¼Œä¸“é—¨ç”¨äºæŠ“å–å¤§å­¦ç ”ç©¶ç”Ÿé¡¹ç›®ä¿¡æ¯ã€‚

## 1. ğŸ“‚ é¡¹ç›®ç›®å½•ç»“æ„ (Directory Structure)

```text
MySpiderProject/
â”œâ”€â”€ main.py                 # ğŸš€ ç¨‹åºå…¥å£ï¼šè´Ÿè´£è°ƒåº¦ã€å‚æ•°è§£æå’Œäº¤äº’å¼é€‰æ‹©
â”œâ”€â”€ config.py               # âš™ï¸ å…¨å±€é…ç½®ï¼šå¤§å­¦ä¿¡æ¯ã€Excel è¡¨å¤´ã€æµè§ˆå™¨å‚æ•°
â”œâ”€â”€ requirements.txt        # ğŸ“¦ é¡¹ç›®ä¾èµ–
â”œâ”€â”€ spiders/                # ğŸ•·ï¸ çˆ¬è™«æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ base_spider.py      #    â””â”€â”€ [åŸºç±»] BaseSpider (å®šä¹‰é€šç”¨æ¥å£)
â”‚   â”œâ”€â”€ hongkong/           #    â””â”€â”€ [åœ°åŒº] é¦™æ¸¯é«˜æ ¡å®ç°
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ uk/                 #    â””â”€â”€ [åœ°åŒº] è‹±å›½é«˜æ ¡å®ç°
â”‚   â””â”€â”€ usa/                #    â””â”€â”€ [åœ°åŒº] ç¾å›½é«˜æ ¡å®ç°
â”œâ”€â”€ utils/                  # ğŸ› ï¸ é€šç”¨å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ browser.py          #    â””â”€â”€ æµè§ˆå™¨é©±åŠ¨ç®¡ç† (Chrome Options, Performance)
â”‚   â”œâ”€â”€ selenium_utils.py   #    â””â”€â”€ é«˜çº§ Selenium æ“ä½œ (BrowserPool, Safe Click)
â”‚   â”œâ”€â”€ data_saver.py       #    â””â”€â”€ æ•°æ®å­˜å‚¨ (Excel å¯¼å‡º, Preview)
â”‚   â””â”€â”€ progress.py         #    â””â”€â”€ è¿›åº¦æ˜¾ç¤º (Rich ç»ˆç«¯ç¾åŒ–, å¤šçº¿ç¨‹è¿›åº¦æ¡)
â””â”€â”€ output/                 # ğŸ“‚ æ•°æ®è¾“å‡ºç›®å½•
```

## 2. ğŸ—ï¸ ç³»ç»Ÿæ¶æ„ (Architecture)

### æ ¸å¿ƒç±»å›¾ä¸è°ƒç”¨å…³ç³»

```mermaid
classDiagram
    class Main {
        +main()
        +run_spider()
        +interactive_select_university()
    }
    
    class BaseSpider {
        <<Abstract>>
        +university_info
        +driver
        +run()*
        +close()
    }
    
    class HKUSpider {
        +run()
    }
    
    class Config {
        +UNIVERSITY_INFO
        +SPIDER_REGISTRY
    }
    
    class BrowserTools {
        +get_driver()
        +BrowserPool
    }
    
    class DataSaver {
        +save_excel()
        +preview_data()
    }

    Main --> Config : è¯»å–é…ç½® & æ³¨å†Œè¡¨
    Main --> BaseSpider : å®ä¾‹åŒ–å…·ä½“çˆ¬è™«
    BaseSpider <|-- HKUSpider : ç»§æ‰¿
    BaseSpider ..> BrowserTools : è·å– WebDriver
    BaseSpider ..> DataSaver : ä¿å­˜ç»“æœ
```

## 3. ğŸ”„ å·¥ä½œæµç¨‹ (Workflow)

æ•´ä¸ªçˆ¬è™«çš„å·¥ä½œæµå¦‚ä¸‹ï¼š

### 1ï¸âƒ£ å¯åŠ¨ä¸è°ƒåº¦ (Start & Dispatch)
*   **å…¥å£**: ç”¨æˆ·è¿è¡Œ `main.py`ã€‚
*   **å‚æ•°å¤„ç†**: æ”¯æŒå‘½ä»¤è¡Œå‚æ•° (å¦‚ `python main.py hku --debug`) æˆ–äº¤äº’å¼èœå•é€‰æ‹©å­¦æ ¡ã€‚
*   **å·¥å‚æ¨¡å¼**: æ ¹æ®å­—ç¬¦ä¸² Key (å¦‚ "hku") ä» `SPIDER_REGISTRY` è·å–å¯¹åº”çš„çˆ¬è™«ç±»ã€‚

### 2ï¸âƒ£ åˆå§‹åŒ– (Initialization)
*   **å®ä¾‹åŒ–**: åˆ›å»ºå…·ä½“çˆ¬è™«å®ä¾‹ (å¦‚ `HKUSpider`)ã€‚
*   **æµè§ˆå™¨å‡†å¤‡**:
    *   **å•ä¾‹æ¨¡å¼**: é»˜è®¤æƒ…å†µä¸‹ï¼Œ`BaseSpider` é¦–æ¬¡è¯·æ±‚æ—¶æ‡’åŠ è½½æµè§ˆå™¨ã€‚
    *   **BrowserPool**: åœ¨å¤§é‡å¹¶å‘æ—¶ï¼ˆå¦‚æŠ“å–æµ·é‡è¯¦æƒ…é¡µï¼‰ï¼Œé€šè¿‡ `utils.selenium_utils.BrowserPool` ç®¡ç†å¤šä¸ªæµè§ˆå™¨å®ä¾‹æ± ï¼Œå¤ç”¨ WebDriver ä»¥æé«˜æ€§èƒ½ã€‚
    *   **æ€§èƒ½ä¼˜åŒ–**: `utils.browser.py` é…ç½®äº† `headless=new`ã€ç¦ç”¨å›¾ç‰‡/CSS/JS ç­‰é€‰é¡¹ï¼Œæœ€å¤§åŒ–æŠ“å–é€Ÿåº¦ã€‚

### 3ï¸âƒ£ æ‰§è¡ŒæŠ“å– (Execution)
*   **List Phase**: è®¿é—®å¤§å­¦é¡¹ç›®åˆ—è¡¨é¡µ (`list_url`)ï¼ŒæŠ“å–åŸºæœ¬ä¿¡æ¯ã€‚
*   **Detail Phase (Concurrent)**: 
    *   å¯¹äºéœ€è¦è¿›å…¥è¯¦æƒ…é¡µçš„æ•°æ®ï¼Œä½¿ç”¨ `ThreadPoolExecutor` å¹¶å‘æŠ“å–ã€‚
    *   é…åˆ `utils.progress.CrawlerProgress` åœ¨ç»ˆç«¯æ˜¾ç¤ºå®æ—¶è¿›åº¦æ¡ã€æˆåŠŸ/å¤±è´¥ç»Ÿè®¡ã€‚
    *   æ™ºèƒ½å¤„ç†ï¼šè‡ªåŠ¨å¤„ç†â€œæ–°çª—å£æ‰“å¼€â€ã€â€œç‚¹å‡»è·³è½¬â€ç­‰å¤æ‚äº¤äº’ã€‚

### 4ï¸âƒ£ æ•°æ®å¤„ç†ä¸è¾“å‡º (Output)
*   **æ ‡å‡†åŒ–**: æ•°æ®ç»Ÿä¸€è½¬æ¢ä¸ºå­—å…¸æ ¼å¼ï¼Œå­—æ®µç”± `config.EXCEL_COLUMNS` å®šä¹‰ã€‚
*   **é¢„è§ˆ**: ä½¿ç”¨ Rich åº“åœ¨ç»ˆç«¯æ‰“å°æ¼‚äº®çš„è¡¨æ ¼é¢„è§ˆã€‚
*   **æŒä¹…åŒ–**: `utils.data_saver` å°†ç»“æœä¿å­˜ä¸º Excel (`.xlsx`)ï¼Œè‡ªåŠ¨å¤„ç†æ–‡ä»¶åæ—¶é—´æˆ³ã€‚

## 4. âœ¨ å…³é”®ç‰¹æ€§ (Key Features)

1.  **æ¨¡å—åŒ–è®¾è®¡**: æ–°å¢å­¦æ ¡åªéœ€ç»§æ‰¿ `BaseSpider` å¹¶å®ç° `run()`ï¼Œæ— éœ€ä¿®æ”¹æ¡†æ¶ä»£ç ã€‚
2.  **é«˜æ€§èƒ½å¹¶å‘**: å†…ç½® `BrowserPool` å’Œçº¿ç¨‹æ± ï¼Œæ”¯æŒå¤šçª—å£å¹¶è¡ŒæŠ“å–ã€‚
3.  **é²æ£’æ€§**: 
    *   è‡ªåŠ¨é‡è¯•æœºåˆ¶ã€‚
    *   æ™ºèƒ½ç­‰å¾…å…ƒç´  (`WebDriverWait`)ã€‚
    *   å¼‚å¸¸æ•è·ä¸å¤±è´¥è®°å½•ã€‚
4.  **ç»ˆç«¯ç¾åŒ–**: ä½¿ç”¨ `rich` åº“æä¾›ä¸“ä¸šçš„ CLI ç•Œé¢å’Œè¿›åº¦åé¦ˆã€‚

---

**ğŸ¤– ç»™ ChatGPT çš„æç¤ºè¯å»ºè®®:**

> "æˆ‘çš„é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Python Selenium çš„æ¨¡å—åŒ–é«˜å¹¶å‘çˆ¬è™«æ¡†æ¶ã€‚
>
> **é¡¹ç›®ç»“æ„**:
> *   `main.py`: å…¥å£ä¸è°ƒåº¦ä¸­å¿ƒã€‚
> *   `spiders/`: å­˜æ”¾ç»§æ‰¿è‡ª `BaseSpider` çš„å…·ä½“å­¦æ ¡çˆ¬è™«ã€‚
> *   `utils/`: åŒ…å« `BrowserPool` (æµè§ˆå™¨æ± )ã€`CrawlerProgress` (å¤šçº¿ç¨‹è¿›åº¦ç®¡ç†) å’Œ `DataSaver`ã€‚
> *   `config.py`: ç»Ÿä¸€ç®¡ç†é…ç½®ã€‚
>
> **æ ¸å¿ƒé€»è¾‘**:
> çˆ¬è™«å¯åŠ¨åï¼Œä¼šè‡ªåŠ¨åˆå§‹åŒ–ä¼˜åŒ–è¿‡çš„ Chrome WebDriver (Headless æ¨¡å¼)ã€‚å¯¹äºåˆ—è¡¨é¡µï¼Œå®ƒæŒ‰é¡ºåºè§£æï¼›å¯¹äºè¯¦æƒ…é¡µï¼Œå®ƒä½¿ç”¨çº¿ç¨‹æ± é…åˆ BrowserPool è¿›è¡Œå¹¶å‘æŠ“å–ï¼Œå¹¶å°†ç»“æœå®æ—¶æ˜¾ç¤ºåœ¨ Rich è¿›åº¦æ¡ä¸Šã€‚æœ€ç»ˆç»“æœä¼šè‡ªåŠ¨å¯¼å‡ºä¸º Excelã€‚
>
> è¯·åŸºäºè¿™ä¸ªæ¶æ„..."
